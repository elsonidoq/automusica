\section{Modelando contornos mel\'odicos}
\label{sec:melodic_contour}
Las caracter'isticas definidas en la secci'on anterior son en gran parte restricciones que deber'ian tenerse en cuenta en la construcci'on 
de l'ineas mel'odicas respecto a una cierta pieza musical, sin embargo, ninguna de ellas habla de propiedades de la l'inea mel'odica 
respecto a s'i misma.

En 1960, Leonard Meyer elabor'o una teor'ia acerca de la expectativa en la m'usica aplicando principios gest'alticos de la psicolog'ia. La 
psicolog'ia de la Gestalt define principios que pretenden capturar la forma en que la mente configura los elementos que llegan a ella a trav'es 
de la percepci'on o de la memoria. Por ejemplo, la ley de cierre establece que nuestra mente a~nade los elementos faltantes a para completar una 
figura. De esta forma, en la figura \ref{fig:ley_cierre} se puede ver un c'irculo y un rectangulo, si bien en la imagen s'olo hay partes de ellos.

\begin{imagen}
    \file{images/Gestalt_ley_de_cierre.png}
    \labelname{fig:ley_cierre}
    \desc{Ejemplo de la ley de cierre. Si bien en esta imagen no hay un circulo ni un rectangulo, nuestra mente lo completa. }
    \width{6cm}
\end{imagen}

Luego del trabajo de Meyer, \cite{Narmour91} cuantifica estas reglas en t'erminos de la sucesi'on de intervalos para construir una teor'ia de 
la expectativa de los contornos mel'odicos. 

En lo que sigue, se explican con mayor detalle las teor'ias de Narmour, para luego detallar el modelo de las l'ineas mel'odicas.

\subsection{La teor\'ia de la Implicaci\'on-Realizaci'on}
Como se mension'o en la introducci'on de este cap'itulo, Eugene Narmour, basado en la teor'ia de la expectativa musical de Leonard Meyer, propuso una forma para cuantificar
el grado de expectativa sobre el \emph{contorno melod'ico}. El contorno mel'odico est'a conformado de la sucesi'on de intervalos que ocurren en una melod'ia. Por ejemplo, 
en la figura \ref{fig:simple_melody} se exhibe una melod'ia en donde se tocan las notas Do, Re, Do, Fa\#. 
El contorno mel'odico de la figura \ref{fig:simple_melody} ser'a entonces \IM{2}, \IM{-2}, \IM{6}.
N'otese que esta transformaci'on no es biyectiva, puesto que la melod'ia Re, Mi, Re, Sol\# tiene el mismo contorno.

\begin{imagen}
    \file{images/melody.png}
    \labelname{fig:simple_melody}
    \desc{Melod'ia simple de ejemplo}
    \width{11cm}
\end{imagen}


El modelo de la Implicaci'on-Realizaci'on(IR) asume un sistema cognitivo organizado jer'arquicamente. En esta jerarqu'ia, los sistemas 
de percepci'on m'as simples, como la vista, se encuentran al fondo y los sistemas de percepci'on m'as abstractos o complejos como la memoria
se encuentran en el tope. De esta forma se distinguen dos tipos de procesos expectaci'on denominados procesos \emph{bottom-up} 
y \emph{top-down}. Los procesos bottom-up son aquellos procesos cognitivos en donde se parte de una informaci'on ubicada en los niveles bajos de la jerarqu'ia y se la 
elabora llev'andola a los niveles altos, mientras que los procesos top-down lo hacen en el orden inverso. 

Narmour propone que los procesos que regulan la expectaci'on mel'odica son en mayor medida de tipo bottom-up, es decir, parten de informaci'on puramente sensorial. 
\cite{Krumhansl95} resume en  que seg'un este modelo, la cognici'on de melod'ias puede ser descripta como una sucesi'on de puntos 
de \emph{cierre}, \emph{implicaci\'on} y \emph{realizaci\'on}. Cuando se alcanza un punto de cierre, las expectativas sobre la continuaci\'on 
son d'ebiles mientras que cuando se alcanza un punto de implicaci'on, la expectativa sobre la continuaci'on es fuerte. Seg'un este modelo,
existen seis condiciones que llevan a una sensaci'on de cierre:
\begin{itemize}
 \item Un silencio
 \item Una acento m'etrico fuerte
 \item Una disonancia resolviendo a una consonancia
 \item Una nota corta seguida de una larga
 \item Un intervalo grande seguido de un intervalo m'as peque~no
 \item Un cambio en la direcci'on registral
\end{itemize}

Estas caracter'isticas no son exluyentes, y si ocurren varias en simultaneo, la sensaci'on de cierre es mayor. 
Si no ocurre ninguna de esas condiciones, entonces se establece un punto de implicaci'on, y el 'ultimo itervalo mel'odico recibe el nombre
de \emph{intervalo implicativo}, y el intervalo que sigue al implicativo, recibe el nombre de \emph{intervalo realizado}. 
Un intervalo realizado, puede promover o no una sensacion de cierre, y puede satisfacer o no la implicaci'on establecida por el intervalo 
implicativo. De hecho, violaciones a las implicaci'ones producen efectos est'eticos y afectivos particulares \citep{Narmour91}.
 
Teniendo entonces el contorno de una melod'ia, Narmour define ciertas caracter'isticas relacionadas con la psicolog'ia de la gestalt. A continuaci'on 
se enumeran los cinco principios de esta teor'ia, refiri'endose por intervalos peque~nos, a intervalos de valor absoluto menor o igual a 5 semi tonos, y por intervalos
grandes a aquellos que sean mayores o iguales que 7 semitonos, dejando al intervalo de 6 semitonos fuera de la clasificaci'on puesto que dependiendo del contexto
se comporta como si fuera un intervalo peque~no o como si fuera grande.
\begin{enumerate}
 \item Direcci'on registral: intervalos peque~nos implican continuaci'ones en la misma direcci'on mel'odica, mientras que intervalos grandes implican un cambio de direcci'on.
 \item Diferencia interv'alica: intervalos peque~nos implican otros de tama~no similar mientras que intervalos grandes implican intervalos m'as peque~nos. 
 \item Retorno registral: se cumple cuando la segunda nota del intervalo realizado es id'entica o similar a la primera del intervalo implicativo.
 \item Proximidad: el tama~no del intervalo relizado sera peque~no.
 \item Cierre: se cumple cuando hay un cambio de direcci'on, un movimiento hacia un intervalo m'as peque~no, o ambas situaciones a la vez.
\end{enumerate}

\subsection{El modelo}
\label{sec:contour_model}
Dada un pieza musical, en este caso es de inter'es construir un modelo y entrenarlo con el contorno mel'odico del tema en cuesti'on. De esta forma se puede proyectar
las alturas de las notas del tema, y luego construir la sucesi'on de intervalos mel'odicos tomando la diferencia entre las sucesivas alturas. 

Es importante tener en cuenta que los principios definidos por la teor'ia de Narmour s'olo aplican a contornos mel'odicos. 
Es por ello que de haber varias notas sonando en simult'aneo no ser'a posible aplicar los principios que su teor'ia establece. 
Para solucionar este problema, se tomar'a la \emph{primera voz}, que corresponde a tomar la nota m'as aguda, cada vez que haya varias en simult'aneo\footnote{Seg\'un
la teor'ia de la m'usica, esto no es del todo correcto, pero a los efectos de este trabajo es suficiente}. 
Siendo as'i, puede asumirse que en el tema de entrenamiento no hay notas sonando en simult'aneo. 

Antes de continuar con los detalles del modelo es importante mensionar una simplificaci'on que se hizo a la teor'ia de IR.
Esta simplificaci'on consiste en no analizar las condiciones que hacen que un intervalo realizado
cree un punto de cierre, es decir, se asume que todos los intervalos son implicativos. Se considera que la decisi'on de donde colocar intervalos de cierre es candidata 
a estar ubicada dentro a otro nivel en la jerarqu'ia de modelos para construir l'ineas mel'odicas, puesto que en general los cierres estan asociados a la estructura
del tema, de esta forma, para mantener limitado el alcance de esta tesis, se deja para trabajo a futuro trabajar con puntos de cierre.

Teniendo en mente el objetivo de generar contornos mel'odicos, lo que se est'a buscando es un modelo que permita estimar la probabilidad de una nota, 
dadas las dos anteriores, es decir $P(n_3|n_1, n_2)$. Una forma de llevar a cabo esta estimaci'on es considerar una codificaci'on de los principios del modelo de IR.
Esta codificaci'on corresponde a considerar una funci'on por cada principio que distinga seg'un el principio que corresponda. No existe una 'unica codificaci'on
de estos principios en la literatura, a saber por el autor, por lo menos  \cite{PaieThesis} y \cite{Schellenberg97} han realizado distintas codificaci'ones, 
sin embargo, no se desea poner el foco en cual es la codificaci'on adecuada, sino en dar un marco, en donde dada una cierta codificaci'on, 
se puedan generar contornos mel'odicos con esa codificaci'on.

De esta forma, as'umase un conjunto de caracter'isticas $F_1, \cdots, F_k$, que en principio codificar'ian los principos de Narmour(es decir, $k$ ser'ia igual a $5$), 
sin embargo, no est'an limitadas a ello. Tomando estas caracter'isticas, se puede definir la probabilidad de una nota de la siguiente forma

\begin{align}
\label{eq:general_narmour_model}
P(n_3 | n_1, n_2) = P(F_1(n_1, n_2, n_3), \cdots, F_k(n_1, n_2, n_3)|n_1, n_2)
\end{align}

Definido as'i, este modelo ser'a por dem'as ralo, puesto que los vectores de caracter'isticas, si bien no son tantos, son los suficientes como para no ser observados
por completo en una pieza musical. Un modelo de este tipo es el propuesto por \cite{PaieThesis} para contornos mel'odicos. Una posibilidad para resolver este problema es utilizar una distribuci'on a priori que explique como se distribuyen en general
los vectores de caracter'isticas. Esta distribuci'on a priori podr'ia o bien calcularse para un conjunto grande de piezas musicales, o bien utilizar los resultados 
un experimento como los de \cite{Krumhansl95} o \cite{Schellenberg96}. 
Otra posibilidad es factorizar la distribuci'on conjunta, haciendo asunciones de independencia. Una asunci'on posible utilizada ampliamente en el campo 
de procesamiento de lenguaje natural es asumir que todas las caracter'isticas son independientes entre s'i. Esta asunci'on es conocida como Naive Bayes, y
si bien no es cierta en la mayor'ia de los problemas, se han obtenido resultados considerablemente buenos utiliz'andola. 
En este caso, la expresi'on \ref{eq:general_narmour_model} se reescribir'a como

\begin{align}
P(n_3 | n_1, n_2) = \prod_{i=1}^k P(F_i(n_1, n_2, n_3)|n_1, n_2)
\end{align}

En \cite{Schellenberg96}, se realizaron una serie de experimentos para poner a prueba el modelo de IR. Uno de los experimentos constaba en exponer a 
sujetos a una melod'ia que finalizaba por la mitad, y los sujetos ten'ian que decir cual ser'ia la continuaci'on que ellos esperar'ian. 
Luego, uno de los an'alisis que se realiz'o, fue la correlaci'on entre los principios del modelo aplicados a las respuestas de los sujetos, 
y se encontr'o que algunos de ellos estaban correlacionados. Utilizando este conocimiento se podr'ia efectuar una factorizaci'on que est'e en el medio entre 
la distribuci'on conjunta y la Naive.

Una vez elegida la codificaci'on y la factorizaci'on de la distribuci'on a utilizar, se puede incorporar el contexto arm'onico como una caracter'istica m'as 
obteniendo una distribuci'on de probabilidades para las continuaciones de una melod'ia y asumiendo independencia entre el contexto arm'onico y el contorno mel'odico
se puede escribir la probabilidad de la siguiente forma:

$$P(n_3 | n_1, n_2) = P(F_1(n_1, n_2, n_3), \cdots, F_k(n_1, n_2, n_3)|n_1, n_2) P(n_3|\theta)$$

\subsection{Codificaci\'ones existentes}
Como ya se mension'o con anterioridad, existe m'as de una codificaci'on en la literatura para los principios de Narmour. 
En esta secci'on se har'a mensi'on de algunas puesto que en el cap'itulo \ref{cap:experiments} se realizar'a una comparaci'on
entre las composiciones que son generadas a partir de utilizar una u otra codificaci'on. Se se omitir'a la propuesta por \cite{PaieThesis}
puesto que se considera que no difiere lo suficiente de la propuesta por \cite{Schellenberg97} y las diferencias radican en intentar disminuir
el espacio de posibles estados.


Si bien se podr'ia exhibir las codificaci'ones como funciones $F_i$ como se las utiliz'o en la secci'on anterior, esto ser'ia por dem'as engorroso de leer.
Es por esto que se utilizar'a un esquema de visualizaci'on simple definido por \cite{Narmour91}. Este esquema consiste en una tabla de doble entrada. 
Las filas corresponden a la longitud del intervalo implicativo, mientras que las columnas corresponden a la longitud del intervalo realizado.
En la figura \ref{fig:grilla_narmour} se exhibe un ejemplo de la tabla vac'ia.

\begin{imagen}
    \file{images/grilla_narmour.png}
    \labelname{fig:grilla_narmour}
    \desc{Grilla para visualizar distintas codificaci'ones a los principios de la teor'ia de IR. Imagen tomada de \cite{Schellenberg97}}
    \width{14cm}
\end{imagen}

De esta forma, para codificar un cierto principio basta con asignar valores a distintas posici'ones en esta grilla. Obs'ervese que la primer fila 
no abarca todo el ancho, puesto que si el intervalo implicativo es de longitud 0, el concepto de ``misma direcci'on'' o ``diferente direcci'on'' dejan
de tener sentido.

En la figura \ref{fig:narmour_coding1} se exhibe la codificaci'on original propuesta por Schellemberg para poder poner los principios a prueba.
A modo ilustrativo, seg'un esa codificiaci'on, el principio de direcci'on registral valdr'a 1 en dos casos: si el intervalo implicativo tiene de 0 a 5 semitonos y el 
realizado tiene de 1 a 12 semitonos en la misma direcci'on, o bien si el intervalo implicativo tiene de 7 a 11 semitonos y el realizado tiene de 0 a 12 semitonos 
en la direcci'on opuesta.


\begin{imagen}
    \file{images/narmour_coding1.png}
    \labelname{fig:narmour_coding1}
    \desc{Codificaci\'on de los principios de Narmour. Imagen tomada de \cite{Schellenberg97}}
    \width{10cm}
\end{imagen}


En \cite{Schellenberg96}, el autor not'o que existe redundancia en los principios propuestos por \cite{Narmour91}, y con el objeto de explicar los datos
generados por sus experimentos, redujo el modelo a un modelo de tres principios. Este modelo se presenta en la figura \ref{fig:narmour_revisited}.
La raz'on por la que se redujo de 5 principios a 3 es porque los principios de proximidad, diferencia interv'alica y cierre estaban altamente 
correlacionados. De esta forma se dej'o solamente uno, proximidad, con mayor detalle. Los principios de direcci'on registral y retorno registral
fueron recodificados a partir de los resultados de \cite{CuddyLunney95}.

\begin{imagen}
    \file{images/narmour_revisited.png}
    \labelname{fig:narmour_revisited}
    \desc{Codificaci\'on de los principios de Narmour. Imagen tomada de \cite{Schellenberg97}}
    \width{9cm}
\end{imagen}



Luego, bas'andose en los datos y resultados de los experimentos de \cite{Schellenberg96} y \citet{CuddyLunney95}, Schellemberg aplica el m'etodo de 
las componentes principales al modelo definido en su trabajo anterior llegando a un modelo con s'olo dos principios cuya codificaci'on
se presenta en la figura \ref{fig:narmour_simplified}. 
Obs'ervese que el principio denominado como \emph{pitch-reversal} es una combinaci'on de los principios direcci'on registral y retorno registral del modelo revisado. 

\begin{imagen}
    \file{images/narmour_simplified.png}
    \labelname{fig:narmour_simplified}
    \desc{Modelo reducido de propuesto por \cite{Schellenberg97}, de donde fue tomada esta imagen}
    \width{10cm}
\end{imagen}

