\section{Modelando contornos mel\'odicos}
\label{sec:melodic_contour}
Las caracter'isticas definidas en la secci'on anterior son en gran parte restricciones que deber'ian tenerse en cuenta en la construcci'on 
de l'ineas mel'odicas respecto a una cierta pieza musical, sin embargo, ninguna de ellas habla de propiedades de la l'inea mel'odica 
por si s'ola.

En 1960, Leonard Meyer elabor'o una teor'ia acerca de la expectativa en la m'usica aplicando principios gest'alticos de la psicolog'ia. La 
psicolog'ia de la Gestalt define principios que pretenden capturar la forma en que la mente configura los elementos que llegan a ella a trav'es 
de la percepci'on o de la memoria. Por ejemplo, la ley de cierre establece que nuestra mente a~nade los elementos faltantes a para completar una 
figura. De esta forma, en la figura \ref{fig:ley_cierre} se puede ver un c'irculo y un rectangulo, si bien en la imagen s'olo hay partes.

\begin{imagen}
    \file{images/Gestalt_ley_de_cierre.png}
    \labelname{fig:ley_cierre}
    \desc{Ejemplo de la ley de cierre. Si bien en esta imagen no hay un circulo ni un rectangulo, nuestra mente lo completa. }
    \width{6cm}
\end{imagen}

Luego del trabajo de Meyer, Eugene Narmour en (\cita) cuantifica estas reglas en t'erminos de intervalos para construir una teor'ia de 
la expectativa de los contornos mel'odicos. 

En lo que sigue, se explican con mayor detalle las teor'ias de Narmour, para luego detallar el modelo de las l'ineas mel'odicas.

\footnote{definir pitch class y nota y equivalencia entre notas de diferente octava en las secciones de background} 

\subsection{La teor\'ia de la Implicaci\'on-Realizaci'on}
Como se mencion'o en la introducci'on de este cap'itulo, Eugene Narmour, basado en la teor'ia de la expectativa musical de Leonard Meyer, propuso una forma para cuantificar
el grado de expectativa sobre el \emph{contorno melod'ico}. El contorno mel'odico est'a conformado de la sucesi'on de intervalos que ocurren en una melod'ia. Por ejemplo, 
en la figura \ref{fig:simple_melody} se exhibe una melod'ia en donde se tocan las notas Do, Re, Do, Fa\#. 

\begin{imagen}
    \file{images/melody.png}
    \labelname{fig:simple_melody}
    \desc{Melod'ia simple de ejemplo}
    \width{11cm}
\end{imagen}

El contorno mel'odico de la figura \ref{fig:simple_melody} ser'a entonces \IM{2}, \IM{-2}, \IM{6}.
Notar que esta transformaci'on no es biyectiva, puesto que la melod'ia Re, Mi, Re, Sol\# tiene el mismo contorno.

\alert{este parrafo esta enterito sujeto a revision =D}

El modelo de la Implicaci'on-Realizaci'on(I-R) toma de (\cita) que el sistema cognitivo se encuentra organizado jer'arquicamente. En esta jerarqu'ia, los sistemas 
de percepci'on m'as simples, como la vista, se encuentran al fondo y los sistemas de percepci'on mas abstractos o complejos como la memoria o la 
resoluci'on de problemas se encuentran en el tope. De esta forma se distinguen dos tipos de procesos expectaci'on denominados procesos \emph{bottom-up} 
y \emph{top-down}. Los procesos bottom-up son aquellos procesos cognitivos en donde se parte de una informaci'on ubicada en los niveles bajos de la jerarqu'ia y se la 
elabora llev'andola a los niveles altos, mientras que los procesos top-down lo hacen en el orden inverso. 

Narmour propone que los procesos que regulan la expectaci'on mel'odica son en mayor medida de tipo bottom-up, es decir, parten de informaci'on puramente sensorial. 
Carol Krumhansl resume en (\cita) que seg'un este modelo, la cognici'on de melod'ias puede ser descripta como una sucesi'on de puntos 
de \emph{cierre}, \emph{implicaci\'on} y \emph{realizaci\'on}. Cuando se alcanza un punto de cierre, las expectativas sobre la continuaci\'on 
son d'ebiles mientras que cuando se alcanza un punto de implicaci'on, la expectativa sobre la continuaci'on es fuerte. Seg'un este modelo,
existen seis condiciones que llevan a una sensaci'on de cierre:
\begin{itemize}
 \item Silencio
 \item Una acento metro fuerte
 \item Una disonancia resolviendo a una consonancia
 \item Una nota corta seguido de una larga
 \item Un intervalo grande seguido de un intervalo m'as peque~no
 \item Un cambio en la direcci'on registral
\end{itemize}

Estas caracter'isticas no son exluyentes, y si ocurren varias en simultaneo, la sensaci'on de cierre es mayor. 
Si no ocurre ninguna de esas condiciones, entonces se establece un punto de implicaci'on, y el 'ultimo itervalo mel'odico recibe el nombre
de \emph{intervalo implicativo}, y el intervalo que sigue al implicativo, recibe el nombre de \emph{intervalo realizados}. 
Un intervalo realizado, puede promover o no una sensacion de cierre, y puede satisfacer o no la implicaci'on establecida por el intervalo 
implicativo
 
Teniendo entonces el contorno de una melod'ia, Narmour define ciertas caracter'isticas relacionadas con la psicolog'ia de la gestalt. A continuaci'on 
se enumeran los cinco principios de esta teor'ia, refiri'endose por intervalos peque~nos, a intervalos de valor absoluto menor o igual a 5 semi tonos, y por intervalos
grandes a aquellos que sean mayores o iguales que 7 semitonos, dejando al intervalo de 6 semitonos fuera de la clasificaci'on.
\begin{enumerate}
 \item Direcci'on registral: intervalos peque~nos implican continuaci'ones en la misma direcci'on mel'odica, mientras que intervalos grandes implican un cambio de direcci'on
 \item Diferencia interv'alica: intervalos peque~nos implican otros de tama~no similar y que intervalos grandes implican intervalos m'as peque~nos. 
 \item Retorno registral: se cumple cuando la segunda nota del intervalo realizado es id'entica o similar a la primera del intervalo implicativo.
 \item Proximidad: el tama~no del intervalo relizado sera peque~no.
 \item Cierre: se cumple cuando hay un cambio de direcci'on, un movimiento hacia un intervalo m'as peque~no, o ambas situaciones a la vez (\alert{reescribir})
\end{enumerate}

\subsection{Simplificaci\'ones a I-R}
A continuaci'on se proponen dos modelos. Ambos hacen ciertas simplificaciones sobre la teor'ia de Narmour, aunque uno en mayor medida que el otro. Se 
podr'ia decir que el primero es una versi'on Naive del seguno. El primero parte de una simplificaci'on a algunos principios de la teor'ia de Narmour. Estas simplificaciones permiten construir una cadena de Markov tradicional para el contorno 
mel'odico. Se presenta este modelo como punto de comparaci'on con el segundo que, si bien sigue simplificando la teor'ia de Narmour, lo hace en menor medida. 

Dada un pieza musical, en este caso es de inter'es construir un modelo y entrenarlo con el contorno mel'odico del tema en cuesti'on. De esta forma se puede proyectar
las alturas de las notas del tema, y luego construir la sucesi'on de intervalos mel'odicos tomando la diferencia entre las sucesivas alturas. Por ahora as'umase que 
en el tema de entrenamiento no hay notas sonando en simult'aneo, puesto que en ese caso, no es trivial construir una sucesi'on de intervalos mel'odicos que represente
lo que esta ocurriendo. Se tratar'a con esa cuesti'on m'as adelante.

La primera simplificaci'on a la teor'ia de Narmour, compartida por los dos modelos, es no analizar las condiciones que hacen que un intervalo realizado
no sea implicativo, es decir, se asume que todos los intervalos son implicativos. Se considera que la desici'on de donde colocar intervalos de cierre es candidata 
a estar ubicada dentro a otro nivel en la jerarqu'ia de modelos para construir lineas mel'odicas, puesto que en general los cierres estan asociados a la estructura
del tema, de esta forma, para mantener limitado el alcance de esta tesis, se deja para trabajo a futuro trabajar con puntos de cierre.

Uno de los modelos es una cadena de Markov, y se realiz'o una modificaci'on al enunciado del principio de diferencia interv'alica para disminuir la cantidad
de estados Markov. En lugar de codificiar que intervalos peque~nos impliquen intervalos de tama~no \texttt{similar}, se codific'o que 
intervalos \texttt{peque~nos} implican intervalos \texttt{peque~nos}. Para los intervalos grandes se hizo lo mismo: intervalos \texttt{grandes} implican 
intervalos \texttt{grandes}. Esta simplificaci'on hace que a la hora de generar melod'ias, no sea necesario conocer el tama~no del intervalo recien generado, y baste 
con saber si 'este fue grande o peque~no.

\alert{falta argumentar que uso solo dos principios, o tres}
\subsection{La cadena de Narmour}
\label{sec:markov_narmour}
Con las simplificaciones propuestas a continuaci'on se detalla el modelo de Markov para la teor'ia de Implicaci'on-Realizaci'on.
Dada una sucesi'on de alturas $a_1, \cdots, a_n$ se construye la sucesi'on de intervalos mel'odicos $m_1, \cdots, m_{n-1}$ donde $m_i = a_{i+1}-a_i$. 

Se define el predicado $T(m)$ que toma 3 valores: grande, peque~no o mediano utilizando la clasificaci'on de Narmour y definiendo mediano como el intervalo de 
6 semitonos que queda fuera de la clasificaci'on. Se define tambi'en el predicado $D(m)$ que toma dos valores: ascendente y descendente seg'un el signo del intervalo.

De esta forma, los estados de la cadena de Markov estar'an dados por vectores $<T, D>$ para los distintos valores de estos predicados. Notar que esta representaci'on
resulta en un modelo muy compacto con $6$ estados en total, lo cual permite entrenar con temas cortos.

La sem'antica de realizar una caminata en este modelo impone restricciones sobre el tipo de intervalo a tocar, dado que se sabe el tipo de intervalo que se 
toc'o previamente, por lo tanto, para generar una linea mel'odica es necesario elegir una nota del conjunto de candidatas. Esta elecci'on se har'a utilizando el contexto
arm'onico.

En la figura \ref{fig:markov_narmour} se exhibe el modelo entrenado para un fragmento de un trio Mozart (\alert{conseguir los nombres posta de los temas}). 
La etiqueta de los estados es una codificaci'on de los dos principios utilizados refiriendo al tama~no del intervalo: chico, mediano para el tritono y grande. Se 
le agrega el signo ``-'' cuando el intervalo es descendente.


\begin{imagen}
    \file{images/narmour_mzt_trio.png}
    \labelname{fig:markov_narmour}
    \desc{Cadena de Markov del modelo de Narmour}
    \width{12cm}
\end{imagen}

\subsection{Un modelo un poco mas general}
Si se plantea el problema en t'erminos un poco m'as generales, lo que se est'a buscando es un modelo que permita estimar la probabilidad de una nota, 
dadas las dos anteriores, es decir $P(n_3|n_1, n_2)$. Una forma de llevar a cabo esta estimaci'on es considerar una codificaci'on de los principios del modelo de IR.
Esta codificaci'on corresponde a considerar una funci'on por cada principio que distinga seg'un el principio que corresponda. Se han realizado una gran cantidad
de codificaciones en la literatura, a saber por el autor, por lo menos Paiement (\cita), Schellember(\cita), sin embargo, no se desea poner el foco en cual es 
la codificaci'on m'as adecuada, sino en dar un marco, en donde dada una cierta codificaci'on, se puedan generar l'ineas mel'odicas con esa codificaci'on.

De esta forma, as'umase un conjunto de caracter'isticas $F_1, \cdots, F_k$, que en principio codificar'ian los principos de Narmour(es decir, $k$ ser'ia igual a $5$), 
sin embargo, no est'an limitadas a ello. Tomando estas caracter'isticas, se puede definir la probabilidad de una nota de la siguiente forma

$$P(n_3 | n_1, n_2) = P(F_1(n_1, n_2, n_3), \cdots, F_k(n_1, n_2, n_3))$$\alert{como le pongo numerito a esto?}

Definido asi, este modelo ser'a por dem'as ralo, puesto que los vectores de caracter'isticas, si bien no son tantos, son los suficientes como para no ser observados
por completo en una pieza musical. Una posibilidad para resolver este problema es utilizar una distribuci'on a priori que explique como se distribuyen en general
los vectores de caracter'isticas. Esta distribuci'on a priori podr'ia o bien calcularse para un conjunto grande de piezas musicales, o bien utilizar los resultados 
un experimento como los de Krumhansl(\cita paper Favio) o Schellemberg(\cita testing Narmour). \alert{Que hacemos con esto? lo hacemos o lo pateamos?} 
Otra posibilidad es factorizar la distribuci'on conjunta, haciendo asunciones de independencia. Una asunci'on posible utilizada ampliamente en el campo 
de procesamiento de lenguaje natural es asumir que todas las caracter'isticas son independientes entre s'i. Esta asunci'on es conocida como Naive Bayes, y
si bien no es cierta en la mayor'ia de los problemas, se han obtenido resultados considerablemente buenos utilizandola, puesto que permite simplificar
los modelos y los algoritmos de entrenamiento. En este caso, la expresi'on \red{de arriba} se reescribir'a como

$$P(n_3 | n_1, n_2) = \prod_{i=1}^k P(F_i(n_1, n_2, n_3))$$

Otra posibilidad es utilizar an'alisis de correlaci'on empirica entre las caracter'isticas. En Schellemberg (\cita testing narmour), se realizaron una serie
de experimentos para poner a prueba el modelo de IR. Uno de los experimentos constaba en exponer a sujetos a una melod'ia que finalizaba por la mitad, y los sujetos
ten'ian que decir cual ser'ia la continuaci'on que ellos esperar'ian. Luego, uno de los an'alisis que se realiz'o, fue la correlaci'on entre los principios del modelo
aplicados a las respuestas de los sujetos, y se encontr'o que algunos de ellos estaban correlacionados. Utilizando este conocimiento se podr'ia efectuar
una factorizaci'on que est'e en el medio entre la distribuci'on conjunta y la Naive.

Una vez elegida la codificaci'on y la factorizaci'on de la distribuci'on a utilizar, se puede incorporar el contexto arm'onico como una caracter'istica m'as 
obteniendo una distribuci'on de probabilidades para las continuaciones de una melod'ia y asumiendo independencia entre el contexto arm'onico y el contorno mel'odico
se puede escribir la probabilidad de la siguiente forma:

$$P(n_3 | n_1, n_2) = P(F_1(n_1, n_2, n_3), \cdots, F_k(n_1, n_2, n_3)) P(n_3|\theta)$$
